<!DOCTYPE html>
<html>

<head>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
	    crossorigin="anonymous">
	<link rel=stylesheet type="text/css" href="css/stylesheet.css">
	<script src="https://unpkg.com/react@latest/dist/react.js"></script>
	<script src="https://unpkg.com/react-dom@latest/dist/react-dom.js"></script>
	<script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>

</head>

<body>

	<div class="container-fluid container-6">
		<div class="row">
			<div class="col-md-offset-5">
				<h1>Övning 16</h1>
			</div>
		</div>
	</div>

	<div class="container">

		<div id="app">
			<h3>Failed to fetch data</h3>
		</div>

	</div>

	<script type="text/babel">
	
	
	class App extends React.Component{
	constructor(props){
		super(props);

		this.state = {
			data: [],
			numberOfCountries : 0,
			selectedCountryId: null

		}
	}


	componentDidMount(){

	let _this = this;

		fetch('http://forverkliga.se/JavaScript/api/simple.php?world')
		.then(function(response){
		
		return response.json();
		})

		.then(function(json){
			let count = json.length;
			_this.setState({data: json, numberOfCountries: count})
		})
	}

	select(event, countryId){
		console.log(event.target.id)

		console.log(countryId);
		this.setState({
				selectedCountryId: countryId
		})
		
	}

	diSelect(){
		this.setState({
			selectedCountryId: null
		})
	}

    		render(){
			return(
			<div>
				<h3>List of Countries</h3>
				<CountriesList data={this.state.data} selectedCountry={this.state.selectedCountryId} setSelected={this.select.bind(this)} diSelect={this.diSelect.bind(this)}/>
				<h4>Det finns {this.state.numberOfCountries} länder i listan</h4>
			</div>
			)
		}
}

class CountriesList extends React.Component{
		constructor(props){
		super(props);

		}

		clickFunction(countryId, event) {

		event.stopPropagation();


        if (event.target.id === 'deleteBtn') {
            this.props.onDelete(countryId);
    
        }

        else if(event.target.id.includes('Label')){

			console.log('Label clicked');
			let labelItem= event.target.id.split('Label', 1);
			console.log(labelItem);
			event.target.className = '';
			event.target.className = 'hide';

			let textBox = document.getElementById(labelItem + 'Textbox');
			textBox.className = '';
			textBox.className = 'show';

			console.log(countryId);

			this.props.setSelected(event, countryId);

        } 

		else if(event.target.id.includes('Textbox')){
			console.log('Textbox clicked')
		}
		
		else {	



			}	

        
		}

		blurFunction(event, countryId){

			console.log('blurred');

			let inputs = document.getElementsByTagName('input');

			let textBoxes = [];

			for(let x in inputs){
				console.log(inputs[x]);
				if(inputs[x].id.includes('Textbox')){
					textBoxes.push(inputs[x]);
				}
			}

			for(let box in textBoxes){
				textBoxes[box].className = '';
				textBoxes[box].className = 'hide'
			}

			let labels = document.getElementsByTagName('label');

			for (let label in labels){
				labels[label].className = '';
				labels[label].className = 'show';
			}

			this.props.diSelect();


	
			}

		editCountry(event, countryId){
			
			console.log(event.target);
			console.log(countryId);
			console.log(event.keyCode);
			if(event.key === 'Enter'){

				this.props.setSelected(event, countryId);

				let textboxItem= event.target.id.split('Textbox', 1);
				console.log(textboxItem);
				event.target.className = '';
				event.target.className = 'hide';

				let label = document.getElementById(textboxItem + 'Label');
				label.className = '';
				label.className = 'show';
			
}



		}

		render(){
			const list = this.props.data.map((country, countryId) =>
            <li
                onClick={this.clickFunction.bind(this, countryId)}
				
                key={countryId}
                className='list-group'>
							
                Country:  <label id="countrynameLabel" className="show">{country.name}</label><input type="text" id="countrynameTextbox" className="hide textBox" onBlur={this.blurFunction.bind(this, countryId)} onKeyPress={this.editCountry.bind(this, countryId)}></input>
				Continent: <label id="continentLabel" className="show">{country.continent}</label><input type="text" id="continentTextbox" className="hide textbox" onBlur={this.blurFunction.bind(this, countryId)} onKeyPress={this.editCountry.bind(this, countryId)}></input> 
                Population: <label id="populationLabel" className="show">{country.population}</label><input type="text" id="populationTextbox" className="hide" onBlur={this.blurFunction.bind(this, countryId)} onKeyPress={this.editCountry.bind(this, countryId)}></input> 

				{this.props.selectedCountryId === countryId &&
                    <button
                        id="deleteBtn"
                        onClick={this.clickFunction.bind(this, countryId)}
                        className={'btn trash-btn'}>
                        <span className="glyphicon glyphicon-trash"></span>
                    </button>
                }
            </li>);

        return (
            <div>
                <ul className='list-group'>
                    {list}
                </ul>
            </div>
        );
	
}
}
	ReactDOM.render(
		<App/>,
		document.getElementById('app')
	)


	
	
	
	
	
	</script>


	<!--<script src="scripts/ovning16.js" type="text/babel"></script>-->

</body>

</html>